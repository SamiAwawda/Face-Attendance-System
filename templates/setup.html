{% extends "layout.html" %}

{% block title %}Class Setup - Face Attendance System{% endblock %}

{% block content %}
<div class="container">
    <div class="row min-vh-100 align-items-center justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="cyber-card">
                <div class="text-center mb-4">
                    <h1 class="neon-text mb-3">
                        <i class="fas fa-user-graduate"></i>
                        Face Attendance
                    </h1>
                    <p class="text-muted">Initialize Your Class Session</p>
                </div>

                <form id="setupForm">
                    <div class="mb-3">
                        <label for="doctorName" class="form-label">
                            <i class="fas fa-user-tie"></i> Doctor Name
                        </label>
                        <input type="text" class="form-control" id="doctorName" name="doctor_name"
                            placeholder="Enter doctor name" required>
                    </div>

                    <div class="mb-3">
                        <label for="courseName" class="form-label">
                            <i class="fas fa-book"></i> Course Name
                        </label>
                        <input type="text" class="form-control" id="courseName" name="course_name"
                            placeholder="Enter course name" required>
                    </div>

                    <div class="mb-4">
                        <label for="courseCode" class="form-label">
                            <i class="fas fa-code"></i> Course Code
                        </label>
                        <input type="text" class="form-control" id="courseCode" name="course_code"
                            placeholder="Enter course code" required>
                    </div>

                    <button type="submit" class="btn btn-cyber w-100">
                        <i class="fas fa-rocket me-2"></i>
                        Start Session
                    </button>
                </form>

                <div class="text-center mt-4">
                    <small class="text-muted">
                        <i class="fas fa-shield-alt"></i>
                        Powered by MediaPipe & DeepFace
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('setupForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const formData = new FormData(this);

        // Show loading
        Swal.fire({
            title: 'Starting Session...',
            html: 'Please wait',
            allowOutsideClick: false,
            didOpen: () => {
                Swal.showLoading();
            }
        });

        try {
            const response = await fetch('/start_session', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();

            if (data.success) {
                Swal.fire({
                    icon: 'success',
                    title: 'Session Started!',
                    text: 'Redirecting to dashboard...',
                    timer: 1500,
                    showConfirmButton: false
                }).then(() => {
                    window.location.href = data.redirect;
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: data.message
                });
            }
        } catch (error) {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Failed to start session. Please try again.'
            });
        }
    });
</script>
{% endblock %}